name: Build and publish package
on:
  push:
    branches: [ master ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on

    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: [ '12', '14', '16' ]
    steps:
      - uses: actions/checkout@v2
      - name: Setup node
      - name: Setup node
      uses: actions/setup-node@v2
      with:
        node-version: ${{ matrix.node }}
        - run: npm install
        - run: npm install -g typescript
      - name: build
        id: build
        run: tsc
  test:
    needs: [build]
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: [ '12', '14', '16' ]
    steps:
      - uses: actions/checkout@v2
      - name: Setup node
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node }}
        - run: npm install
        - run: npm install -g typescript
        - run: npm install -g mocha ts-node
      - name: Run Tests
        id: test
        run: npm run test
  publish:
    needs: [ build, test ]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: stub
        run: echo stub

  send_report:
    if: always()
    needs: [ build, test, publish ]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Private actions checkout
        uses: daspn/private-actions-checkout@v2
        with:
          actions_list: '["roiperlman/telegram_notifier@master"]'
          checkout_base_path: ./.github/actions/external
          app_id: ${{ secrets.APP_ID }}
          app_private_key: ${{ secrets.APP_PRIVATE_KEY }}
      - name: notify
        uses: ./.github/actions/external/telegram_notifier
        with:
          message: >
            Workflow Execution Summary:
            📂 Repository ${{ github.event.repository.name }}:
            🔧 Workflow: ${{ github.workflow }}
            ❗️Status: ${{ job.status }}

            Jobs Status::
              ▪️Build: ${{jobs.build.outcome}}
              ▪️Test: ${{jobs.test.outcome}}
              ▪️Publish: ${{jobs.test.outcome}}






